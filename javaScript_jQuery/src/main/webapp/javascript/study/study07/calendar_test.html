<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>중앙 학원 달력_JH</title>
<SCRIPT>

	var dateObject = new Date();
	
	// 달력이 가르키고 있는 년도, 달
	var calYear = dateObject.getFullYear();	
	var calMonth = dateObject.getMonth();
	var calDate = dateObject.getDate();
	var calDay = dateObject.getDay();

	// 오늘 날짜 저장
	var todayYear = calYear;
	var todayMonth = calMonth;
	var todayDate = calDate;
	
	// 달력에 넣어질 날짜 변수
	var num;
	
	// 각 태그에 적용할 inline style 들
	var title_style = "color:darkblue;" + "background-color:#E6DFDF;" + "text-align:center;" + "height:80px";
	var day_style = "color:darkblue;" + "background-color:#FFEFFF;" + "text-align:center;" + "width:100px;" + "height:80px;" + "font-weight:bold";
	var date_style = "background-color:#FFEFEE;" + "vertical-align:top;" + "text-align:right;" + "height:80px;";
	var today_style = "color:red";
	var time_style = "color:purple;" + "text-align:center";
	var paddings = "padding:10px";
	
	var startPos;// 달력에서 시작될 지점
	var lastDate; // 지금 달의 마지막 날짜
	
	
	var table_tag;  // 테이블 전체 생성 태그 저장
	var table_make; // 테이블 내용 생성 태그 저장(<tr><td></td><tr> 들)
	
	// <table> 껍데기 씌우기
	table_tag = "<table id='cal' style='border-spacing: 3px; margin:0px auto'>";
	
	//  <tr>~</tr> 만들기
	// <tr>~</tr> 부분을 만드는 메소를 만든 이유는 날짜 변경시 innerHTML을 이용하여
	// table의 내용을 변경하기 위함
	
	make_TRTD(); 
	
	table_tag += table_make;
	
	table_tag += "</table>";    // 마무리
	document.write(table_tag);  // 생성
	

function make_TRTD(){
	
	num = 1;
	table_make="";
	
	startPos = getStartPos(); // 달력에서 시작될 지점
	lastDate = getLastDate(); // 지금 달의 마지막 날짜
	
	calendar_titleRow();         // 달력 타이틀 부분 생성
	console.log(calYear + " " + calMonth);
	calendar_dayRow();  		 // 달력 요일 부분 생성
	console.log(calYear + " " + calMonth);
	calendar_dateRow1(startPos);		 // 달력 첫번쨰 날짜줄 생성
	console.log(calYear + " " + calMonth);
	calendar_dateRow2(startPos, lastDate); 		 // 달력 나머지 날짜줄 생성
	console.log(calYear + " " + calMonth);
	
}
	// 다음 달 이동
function change_next_month(){
	
	if(calMonth < 11){
		calMonth =calMonth + 1;		
	}
	else{
		
		calMonth = 0;
		calYear = calYear + 1;
	}
	make_TRTD();
	document.getElementById("cal").innerHTML=table_make;
	console.log(calYear + " " + calMonth);
}

// 이전 달 이동
 function change_previous_month(){
	if(calMonth != 0){
		calMonth = calMonth - 1;
	}
	else{
		calYear = calYear - 1;
		calMonth = 11;
	}
	make_TRTD();
	document.getElementById("cal").innerHTML=table_make;
	console.log(calYear + " " + calMonth);
} 

// 달력 중 지금 년도와 월을 출력하는 타이틀 부분 생성 함수
function calendar_titleRow(){	
	
	table_make += "<tr><td colspan='7' style=" + title_style + "><button onclick='change_previous_month()' style='background:#A9A9F5'>이전</button>&nbsp;&nbsp;&nbsp;<font style='font-size:30px'>" 
	+ calYear + "년 "+ (calMonth+1) + "월</font>&nbsp;&nbsp;&nbsp;<button onclick='change_next_month();' style='background:#A9A9F5'>다음</button></td></tr>"; 
	
}

// 달력 중 요일 부분을 생성할 함수
function calendar_dayRow(){	
	
	var days = ['일','월','화','수','목','금','토'];
	
	table_make += "<tr>";
	for(var col=0; col<7; col++){
		table_make += "<td style=" + day_style + ">" + days[col] + "</td>";
	}
	table_make += "</tr>"
}

// 달력 중 날짜가 시작되는 첫번째 줄을 생성할 함수
function calendar_dateRow1(){
	for(var col=0; col<7; col++){
		if(startPos > col){			
			table_make += "<td></td>";
		}
		else{
			
			var num_str = "<span>" + num + "</span>"; 
			
			if(calYear == todayYear && calMonth == todayMonth && todayDate == num){
				
				num_str = "<span style=" + today_style + ">" + num + "</span><br><div style=" + time_style + ">" + getTime() + "</div>";
			}
			
			table_make += "<td style=" + date_style + ">" + num_str + "</td>";
			num++;
		}
	}	
}

// 달력 중 첫번째 줄을 제외한 나머지 부분을 생성할 함수
function calendar_dateRow2(){
	// 필요한 행 개수 구하기(마지막 날짜 - (첫 줄에서 빠진 날 수) / 7) 의 ceil(무조건 올림)
	var needRow = Math.ceil((lastDate - (7-startPos)) / 7);
	for(var row=0; row < needRow; row++){
		table_make += "<tr>";
		for(col=0; col<7; col++){
			if(num <= lastDate){
							
				var num_str = "<span>" + num + "</span>"; 
				
				if(calYear == todayYear && calMonth == todayMonth && todayDate == num){
				
					num_str = "<span style=" + today_style + ">" + num + "</span><br><div style=" + time_style + ">" + getTime() + "</div>";
				}
				
				table_make += "<td style=" + date_style + ">" + num_str + "</td>";
			
				num++;
				
			}
			else{
				table_make += "<td></td>";
			}
		}
		table_make += "</tr>";
	}
}

// 지금 달의 마지막 날짜를 리턴하는 함수
function getLastDate(){
	
	var lastDays = new Array(31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31);
	var isIntercalation;

	 if (calYear % 4 == 0) 
		 isIntercalation = true 
	 else 
		 isIntercalation = false 

	 lastDays[1] = (isIntercalation) ? 29 : 28 
		
	 return lastDays[calMonth]
	
}

// 지금 달의 시작 점을 리턴하는 함수
function getStartPos(){
	
	var firstYMD = new Date(calYear,calMonth,1);
	
	return firstYMD.getDay();
}

// 출력할 시간 문자열을 리턴하는 함수
function getTime(){
	
	var hour = dateObject.getHours();
	var printHour = hour;
	var min = dateObject.getMinutes();
	var printMin = min;
	var ampm = "오전";
	
	if(hour > 12){
		printHour = hour-12;		
		ampm = "오후";
	}
	
	if(printHour < 10){
		printHour = "0" + printHour;
	}
	
	if(printMin < 10){
		printMin = "0" + printMin;
	}
	
	
	return ampm + "<br>" + printHour+":"+printMin;
}

/* 값 나오는 확인용  */
//document.write("시작요일:" + startPos);
//document.write(lastDate);
//document.write("줄:" + Math.ceil((lastDate - (7-startPos)) / 7));
//document.write(d.getHours());
//document.write(d.getMinutes(),"<br>");
//document.write(getTime());

</SCRIPT>
</head>
<body>


</body>
</html>
